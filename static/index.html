<!DOCTYPE html>
<html>
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title> 👋 🤖 DIG Chat </title>
    <link href="Content/css/bootstrap/css/bootstrap.css" rel="stylesheet" />
    <link href="Content/css/site.css" rel="stylesheet" />
    <!-- Add Bootstrap dependencies -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="Content/css/bootstrap/js/bootstrap.js"></script>
    <link rel="icon" type="image/x-icon" href="Content/img/dig-sm-logo.png">
    <!-- Add auth.js first to ensure auth check happens before anything else -->
    <script src="js/auth.js"></script>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar-hover-area"></div>
    <div class="sidebar">
        <button class="new-chat-btn" onclick="window.insuranceAssistant.startNewConversation()">+ New Chat</button>
        <div class="archive-toggle">
            <input type="checkbox" id="showArchived" onchange="window.insuranceAssistant.loadConversations(this.checked)">
            <label for="showArchived">Show archived</label>
        </div>
        <div class="conversation-list">
            <!-- Conversations will be populated by JavaScript -->
        </div>
        <div class="user-info">
            <div class="user-name"></div>
            <button class="logout-btn" onclick="Auth.logout()">Logout</button>
        </div>
    </div>
    <button class="sidebar-toggle"></button>

    <div class="container">
        <!-- Just an image -->
        <nav class="navbar navbar-light bg-light">
            <img src="Content/img/dig-sm-logo-w.png" width="30" height="30" alt="Doha Insurance Group - DIG" title="Doha Insurance Group - DIG" />
            💉 Medical Group Assistant - DIG
        </nav>
        <div class="row">
            <div class="col-md-12">
                <div class="alert alert-info">
                    👋 This is a chatbot that can help you with your medical group policy. It can answer questions about your policy, and help you find the best coverage for your needs.
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-8 col-md-6 col-sm-12 border-r">
                <!-- Add response container structure -->
                <div class="response-container show">
                    <div id="responseContent" class="response-content">
                        <div id="answer" class="answer-section">
                            <div class="container chatcontainer">
                                <div class="chat assistant">👋 Hi I'm a chatbot that can help with your medical group policy; Please Enter Your Insured Qatari ID </div>
                                <div id="loadingIndicator" class="chat assistant loading-indicator hidden">
                                    <span class="loading-text">Processing your request</span>
                                    <span class="loading-dots"><span>.</span><span>.</span><span>.</span></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="textChat">
                    <textarea placeholder="Enter your 11-digit National ID"></textarea>
                    <button class="btnSend">Send</button>
                </div>
            </div>
            <div class="col-lg-4 col-md-6 mobile-hiden">
                <div class="row searchresult">
                    <div class="col-md-4 name">
                        Contractor Name
                    </div>
                    <div class="col-md-1">
                        :
                    </div>
                    <div class="col-md-7" id="contractorName">
                        -
                    </div>
                </div>

                <div class="row searchresult">
                    <div class="col-md-4">
                        Contact Expiry Date
                    </div>
                    <div class="col-md-1">
                        :
                    </div>
                    <div class="col-md-7" id="expiryDate">
                        -
                    </div>
                </div>
                <div class="row searchresult">
                    <div class="col-md-4 name">
                        Individual Name
                    </div>
                    <div class="col-md-1">
                        :
                    </div>
                    <div class="col-md-7 name">
                        -
                    </div>
                </div>

                <div class="row searchresult">
                    <div class="col-md-4">
                        No. of Beneficiaries
                    </div>
                    <div class="col-md-1">
                        :
                    </div>
                    <div class="col-md-7" id="beneficiaryCount">
                        -
                    </div>
                </div>
                <div class="row searchresult">
                    <div class="col-md-4">
                        TOB PDF Link
                    </div>
                    <div class="col-md-1">
                        :
                    </div>
                    <div class="col-md-7">
                        <a data-bs-toggle="modal" data-bs-target="#TOBModal"> View TOB </a>
                    </div>
                </div>

                <div class="suggest" style="display: none;">
                    <div class="title">💡 Suggested Questions</div>
                    <div class="hints">Click on a question to ask it</div>
                    <div class="suggestbtn"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->

    <div class="modal fade" id="TOBModal" tabindex="-1" aria-labelledby="TOBModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5 text-center" id="TOBModalLabel">TOB</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="pdfLoadingIndicator" class="text-center" style="display: none;">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading PDF...</span>
                        </div>
                        <p class="mt-2">Loading PDF...</p>
                    </div>
                    <div id="pdfErrorMessage" class="alert alert-danger" style="display: none;">
                        Failed to load PDF. Please try again later.
                    </div>
                    <iframe id="pdfFrame" style="width: 100%; height: 80vh; border: none;"></iframe>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="MemsModal" tabindex="-1" aria-labelledby="MemsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5 text-center" id="MemsModalLabel"> 👪 Family Members</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body familymem">
                    <!-- Family members will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Add auth.js before app.js -->
    <script src="js/auth.js"></script>
    <script src="js/app.js"></script>
</body>
</html>